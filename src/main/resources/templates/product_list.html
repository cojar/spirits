<!DOCTYPE html>
<html lang="ko" layout:decorate="~{layout}" xmlns:layout="http://www.w3.org/1999/xhtml"
      xmlns:th="http://www.w3.org/1999/xhtml">
<head>
    <meta charset="UTF-8">
    <title>맥주 리스트 페이지</title>
    <link rel="stylesheet" th:href="@{/beer_list_style.css}" type="text/css">
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
</head>
<body>
<div layout:fragment="content">
    <div class="wrap">
        <!-- 위스키 information-box -->
        <span th:text="${mainCategoryId}"></span>
        <div class="information-box" th:if="${mainCategoryId == 1}">
            <div class="title">
                <h2>위스키</h2>
            </div>
            <div class="text">
                발효된 곡물을 증류하여 고알콜 음료로 풍부한 향과 맛을 가진 강력한 스피릿츠 드링크입니다.
            </div>
        </div>
        <!-- 보드카 information-box -->
        <div class="information-box" th:if="${mainCategoryId == 2}">
            <div class="title">
                <h2>보드카</h2>
            </div>
            <div class="text">
                클래식한 투명한 술로, 보드카는 중성적이고 깔끔한 맛을 가진 독특한 알코올 음료입니다.
            </div>
            <div class="img-box">
                <img src="https://blog.kakaocdn.net/dn/cQSygf/btqC5nYOLQO/7JZPafuCyUD2A4q6NSjZYK/img.jpg" alt="">
            </div>
        </div>
        <!-- 데킬라 information-box -->
        <div class="information-box" th:if="${mainCategoryId == 3}">
            <div class="title">
                <h2>데킬라</h2>
            </div>
            <div class="text">
                멕시코에서 탄생한 강력하고 향긋한 술로, 데킬라는 특유의 맛과 효과를 가진 알코올 음료입니다.
            </div>
            <div class="img-box">
                <img src="https://koreadailytimes.com/files/attach/images/149/252/070/dc2f7e851e73692c5e15684b06a71140.jpg" alt="">
            </div>
        </div>
        <!-- 럼 information-box -->
        <div class="information-box" th:if="${mainCategoryId == 4}">
            <div class="title">
                <h2>럼</h2>
            </div>
            <div class="text">
                열대 향기로운 여름의 고향, 럼은 달콤하고 풍부한 맛으로 즐기는 알코올 음료입니다.
            </div>
            <div class="img-box">
                <img src="https://www.omynara.com/wp-content/uploads/2018/12/RUM.jpg" alt="">
            </div>
        </div>
        <!-- 진 information-box -->
        <div class="information-box" th:if="${mainCategoryId == 5}">
            <div class="title">
                <h2>진</h2>
            </div>
            <div class="text">
                고품질의 투명한 술로, 진은 허브와 시트러스의 조화로운 맛과 향을 지니며, 클래식한 칵테일의 필수 재료입니다.
            </div>
            <div class="img-box">
                <img src="https://img1.daumcdn.net/thumb/R1280x0.fjpg/?fname=http://t1.daumcdn.net/brunch/service/user/cqmJ/image/H0MzLVwwne_A7G45vERhdc4jrYo" alt="">
            </div>
        </div>
        <!-- 브랜디 information-box -->
        <div class="information-box" th:if="${mainCategoryId == 6}">
            <div class="title">
                <h2>브랜디</h2>
            </div>
            <div class="text">
                고품질의 코냑산 포도주로 만들어진 강렬하고 부드러우며 귀족적인 멋과 세련된 풍미를 지닌 특별한 스피리트입니다.
            </div>
            <div class="img-box">
                <img src="https://img1.daumcdn.net/thumb/R1280x0.fjpg/?fname=http://t1.daumcdn.net/brunch/service/user/cqmJ/image/uWtyG5bpRo5XHuvNcpohK-dAoT4" alt="">
            </div>
        </div>
        <!-- 맥주 information-box -->
        <div class="information-box" th:if="${mainCategoryId == 7}">
            <div class="title">
                <h2>맥주</h2>
            </div>
            <div class="text">
                상큼하고 가벼운 대중적인 알코올 음료, 맥주는 사람들에게 사랑받는다.
            </div>
            <div class="img-box">
                <img alt="" src="https://img.daily.co.kr/@files/www.daily.co.kr/content/food/2020/20200416/1700df053197b11cc51905180589e995.jpg">
            </div>
        </div>
        <!-- 검색 information-box -->
        <div class="information-box" th:if="${mainCategoryId == null && searchKeyword != null}">
            <div class="title">
                <h2>검색 결과</h2>
            </div>
            <div class="text">
                검색어에 대한 결과입니다.
            </div>
        </div>
        <!--드롭다운메뉴 시작-->
        <div class="drop-down-box">
            <!-- 서브카테고리(중분류) 드롭다운 메뉴 -->
            <div class="SubCategory-box">
                <label for="SubCategory"></label>
                <select id="SubCategory" onchange="filterBySubcategory()">
                    <option value="">중분류 전체</option>
                    <option th:each="subCategory : ${subCategoryList}"
                            th:if="${mainCategoryId == 1 and (subCategory.id >= 1 and subCategory.id <= 7)} or
               ${mainCategoryId == 2 and (subCategory.id >= 8 and subCategory.id <= 10)} or
               ${mainCategoryId == 3 and (subCategory.id >= 11 and subCategory.id <= 15)} or
               ${mainCategoryId == 4 and (subCategory.id >= 16 and subCategory.id <= 22)} or
               ${mainCategoryId == 5 and (subCategory.id >= 23 and subCategory.id <= 27)} or
               ${mainCategoryId == 6 and (subCategory.id >= 28 and subCategory.id <= 31)} or
               ${mainCategoryId == 7 and (subCategory.id >= 32 and subCategory.id <= 36)}"
                            th:text="${subCategory.subCategory}" th:value="${subCategory.id}"></option>
                </select>
            </div>

            <!-- 가격범위 드롭다운 메뉴 -->
            <div class="Costrange-box">
                <label for="Costrange"></label>
                <select id="Costrange" onchange="filterByCostrange()">
                    <option value="가격">가격범위 전체</option>
                    <option th:each="costRange : ${costRangeList}"
                            th:text="${costRange.costRange}" th:value="${costRange.id}"></option>
                </select>
            </div>

            <!-- 알콜도수범위 드롭다운 메뉴 -->
            <div class="ABVrange-box">
                <label for="ABVrange"></label>
                <select id="ABVrange" onchange="filterByABVrange()">
                    <option value="도수">도수범위 전체</option>
                    <option th:each="aBVrange : ${abVrangeList}"
                            th:text="${aBVrange.abvRange}" th:value="${aBVrange.id}"></option>
                </select>
            </div>

            <!-- 용량 드롭다운 메뉴 -->
            <div class="NetWeight-box">
                <label for="NetWeight"></label>
                <select id="NetWeight" onchange="filterByNetWeight()">
                    <option value="용량">용량범위 전체</option>
                    <option th:each="netWeight : ${netWeightList}"
                            th:text="${netWeight.netWeight}" th:value="${netWeight.id}"></option>
                </select>
            </div>

            <!-- 안주 드롭다운 메뉴 -->
            <div class="paring-box">
                <label for="Paring"></label>
                <select id="Paring" onchange="filterByParing()">
                    <option value="안주">안주범위 전체</option>
                    <option th:each="pairing : ${pairingList}"
                            th:text="${pairing.pairing}" th:value="${pairing.id}"></option>
                </select>
            </div>

            <!-- 오크통(캐스크) 드롭다운 메뉴 -->
            <div class="Cask-box">
                <label for="Cask"></label>
                <select id="Cask" onchange="filterByCask()">
                    <option value="오크통">오크통범위 전체</option>
                    <option th:each="cask : ${caskList}" th:text="${cask.cask}" th:value="${cask.id}"></option>
                </select>
            </div>


            <!-- 국가 드롭다운 메뉴 -->
            <div class="Nation">
                <label for="Nation"></label>
                <select id="Nation" onchange="filterByNation()">
                    <option value="국가">국가범위 전체</option>
                    <option th:each="nation : ${nationList}"
                            th:text="${nation.nation}" th:value="${nation.id}"></option>
                </select>
            </div>
        </div>
        <!--개별리스트 목록 끝-->
        <div class="section">
            <p>
            <div class="search-result" style="display : inline-block;" th:text="${productList.size()}"></div>
            건의 결과가 있어요</p>

            <section class="goods-list-section">
                <div class="goods-list">
                    <div class="goods-1" id="goods" th:each="product : ${productList}">
                        <a th:href="@{|/product/detail/${product.id}|}">
                            <img alt=""
                                 src="https://img-cf.kurly.com/cdn-cgi/image/width=400,format=auto/shop/data/goods/1645598047189l0.jpg">
                            <p class="goods-name" style="font-weight : bold; font-size : 2rem;"
                               th:text="${product.name}"></p>
                            <p><span th:text="${product.cost}"></span>원</p>
                        </a>
                    </div>
                </div>
            </section>
        </div>
    </div>
</div>
<!--스크립트 들어가는 자리-->
<script layout:fragment="script" type='text/javascript'>
// 검색 필터링
function filterBySearch() {
    var searchKeyword = $("#search_kw").val();
    filterProducts(null, null, null, null, null, null, null, searchKeyword);
}

// 중분류 선택 시 필터링
function filterBySubcategory() {
    var selectedSubCategory = $("#SubCategory").val();
    filterProducts(selectedSubCategory, null, null, null, null, null, null);
}

// 가격범위 선택 시 필터링
function filterByCostrange() {
    var selectedCostRange = $("#Costrange").val();
    filterProducts(null, selectedCostRange, null, null, null, null, null);
}

// 알콜도수범위 선택 시 필터링
function filterByABVrange() {
    var selectedABVRange = $("#ABVrange").val();
    filterProducts(null, null, selectedABVRange, null, null, null, null);
}

// 용량 선택 시 필터링
function filterByNetWeight() {
    var selectedNetWeight = $("#NetWeight").val();
    filterProducts(null, null, null, selectedNetWeight, null, null, null);
}

// 안주 선택 시 필터링
function filterByParing() {
    var selectedParing = $("#Paring").val();
    filterProducts(null, null, null, null, selectedParing, null, null);
}

// 오크통 선택 시 필터링
function filterByCask() {
    var selectedCask = $("#Cask").val();
    filterProducts(null, null, null, null, null, selectedCask, null);
}

// 국가 선택 시 필터링
function filterByNation() {
    var selectedNation = $("#Nation").val();
    filterProducts(null, null, null, null, null, null, selectedNation);
}

// 제품 필터링 함수
function filterProducts(subCategoryId, costRangeId, abvRangeId, netWeightId, paringId, caskId, nationId, searchKeyword) {
    var url = "/product/list/category?";

    if (subCategoryId !== null) {
        url += "subCategory=" + subCategoryId + "&";
    }

    if (costRangeId !== null) {
        url += "costRange=" + costRangeId + "&";
    }

    if (abvRangeId !== null) {
        url += "abvRange=" + abvRangeId + "&";
    }

    if (netWeightId !== null) {
        url += "netWeight=" + netWeightId + "&";
    }

    if (paringId !== null) {
        url += "paring=" + paringId + "&";
    }

    if (caskId !== null) {
        url += "cask=" + caskId + "&";
    }

    if (nationId !== null) {
        url += "nation=" + nationId + "&";
    }

    if (searchKeyword !== null) {
        url += "searchKeyword=" + searchKeyword + "&";
    }

    url = url.slice(0, -1);

    $.ajax({
        url: url,
        type: "GET",
        success: function (filteredProducts) {
            var goodsList = $(".goods-list");
            goodsList.empty(); // 기존 상품 목록을 비움.

            // 필터링된 상품 목록을 순회하며 HTML 요소를 생성하여 추가.
            filteredProducts.forEach(function (product) {
                var productElement = $("<div></div>")
                    .addClass("goods-1")
                    .append(
                        $("<a></a>")
                            .attr("href", "/product/detail/" + product.id)
                            .append($("<img>").attr("src", product.image))
                            .append($("<p></p>").addClass("goods-name").text(product.name))
                            .append($("<p></p>").text(product.cost + "원"))
                    );
                goodsList.append(productElement);
            });
        },
        error: function (error) {
            console.log(error);
        }
    })
        .done(function (result) {
            console.log(result);
            $("#goods").replaceWith(result);
        });

    $.ajax({
        url: url,
        type: "GET",
        success: function (data) {
            var productList = data.productList;
            var searchResultsDiv = $("#search-results");
            searchResultsDiv.empty();

            // 검색 결과를 동적으로 생성하여 searchResultsDiv에 추가
            productList.forEach(function (product) {
                var productDiv = $("<div>").addClass("product");
                var productName = $("<p>").text(product.name);
                var productPrice = $("<p>").text(product.price + "원");

                productDiv.append(productName, productPrice);
                searchResultsDiv.append(productDiv);
            });
        },
        error: function (jqXHR, textStatus, errorThrown) {
            console.error("Error occurred during filtering products:", textStatus, errorThrown);
        }
    });
}

</script>
</body>
</html>