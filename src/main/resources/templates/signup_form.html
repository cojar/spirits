<!doctype html>
<html lang="ko" xmlns:th="http://www.w3.org/1999/xhtml">
<head>
    <meta charset="UTF-8">
    <meta name="viewport"
          content="width=device-width, user-scalable=no, initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>Spirits 회원가입</title>
    <link rel="stylesheet" type="text/css" th:href="@{/signup_form.css}">
    <style>
        .error-message {
            color: red;
        }

        .checkmark {
            color: green;
        }
    </style>
</head>
<body>
<form th:action="@{/user/signup}" th:object="${userCreateForm}" method="post">
    <div th:replace="~{form_errors :: formErrorsFragment}"></div>
    <div class="big-wrap">
        <div class="wrap">
            <div class="top-bar">
                <div class="logo-box">
                    <div class="logo"><a th:href="@{|/main|}"><img src="https://ifh.cc/g/BRzb5o.png" alt=""></a></div>
                </div>
                <div class="user-box">
                    <div class="login"><a th:href="@{|/user/login|}">로그인</a></div>
                    <div class="sign-up"><a th:href="@{|/user/signup|}">회원가입</a></div>
                </div>
            </div>
            <div class="hello">
                <div class="hello-box">
                    <div class="title">환영합니다! SPIRITS 입니다.</div>

                </div>
            </div>
            <div class="signup-box">
                <div class="email-box">
                    <div class="email-text">계정(이메일 형식) *</div>
                    <div class="email">
                        <input th:field="*{username}" type="email" placeholder="ex)  example@example.com"
                               class="email-input" required="" value="">
                    </div>
                </div>
                <div class="email-box">
                    <div class="email-text">생년월일*</div>
                    <div class="email">
                        <input th:field="*{birthDate}" type="date" placeholder=""
                               class="email-input" required="" value="">
                    </div>
                </div>
                <div class="password-box">
                    <div class="password-text">비밀번호 * (영문,숫자 8글자 이상)</div>
                    <div class="password">
                        <input th:field="*{password1}" type="password" placeholder="비밀번호를 입력해주세요."
                               class="password-input" required="" value="">
                    </div>
                </div>
                <div class="password-check-box">
                    <div class="password-check-text">비밀번호 확인 *</div>
                    <div class="password-check">
                        <input th:field="*{password2}" type="password" placeholder="비밀번호를 입력해주세요."
                               class="password-check-input" required="" value="">
                    </div>
                </div>
                <div class="nickname-box">
                    <div class="nickname-text">닉네임 * (공백,특수문자 제외한 2~10글자)</div>
                    <div class="nickname">
                        <div class="nickname2">
                            <input th:field="*{nickname}" type="text" placeholder="닉네임을 입력해주세요." class="nickname-input"
                                   required="" value="" id="nicknameInput">
                        </div>
                        <button type="button" class="btn btn-primary" id="checkDuplicateBtn">중복확인</button>
                        <div id="nicknameCheckResult"></div>
                    </div>
                </div>
                <div class="signup-btn">
                    <button type="submit" class="btn btn-primary" onclick="showPopup()">회원가입</button>
                </div>
            </div>
        </div>
    </div>
</form>
<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
<script>
    $(document).ready(function () {
        var emailInput = $('input[name="username"]');
        var passwordInput = $('input[name="password1"]');
        var confirmPasswordInput = $('input[name="password2"]');
        var nicknameInput = $('input[name="nickname"]');
        var emailRegex = /^\S+@\S+\.\S+$/;
        var passwordRegex = /^(?=.*[A-Za-z])(?=.*\d)[A-Za-z\d]{8,}$/;

        emailInput.on('input', function () {
            var value = $(this).val();
            var errorMessage = '';
            if (value && !emailRegex.test(value)) {
                errorMessage = '이메일 형식을 지켜주세요.';
            }
            $(this).siblings('.checkmark, .error-message').remove();
            if (errorMessage) {
                $('<div class="error-message"></div>').text(errorMessage).insertAfter($(this));
            } else {
                $('<div class="checkmark">✓</div>').insertAfter($(this));
            }
        });

        passwordInput.on('input', function () {
            var value = $(this).val();
            var errorMessage = '';
            if (value && !passwordRegex.test(value)) {
                errorMessage = '영문, 숫자 8글자 이상을 입력해주세요.';
            }
            $(this).siblings('.checkmark, .error-message').remove();
            if (errorMessage) {
                $('<div class="error-message"></div>').text(errorMessage).insertAfter($(this));
            } else {
                $('<div class="checkmark">✓</div>').insertAfter($(this));
            }
        });

        confirmPasswordInput.on('input', function () {
            var value = $(this).val();
            var passwordValue = passwordInput.val();
            var errorMessage = '';
            if (value && value !== passwordValue) {
                errorMessage = '이전에 입력한 비밀번호와 일치하지 않습니다.';
            }
            $(this).siblings('.checkmark, .error-message').remove();
            if (errorMessage) {
                $('<div class="error-message"></div>').text(errorMessage).insertAfter($(this));
            } else {
                $('<div class="checkmark">✓</div>').insertAfter($(this));
            }
        });

        nicknameInput.on('input', function () {
            var value = $(this).val();
            var errorMessage = '';
            if (value && (value.length < 2 || value.length > 10 || !/^[\wㄱ-ㅎㅏ-ㅣ가-힣]+$/.test(value))) {
                errorMessage = '공백, 특수문자 제외한 2~10글자로 입력해주세요.';
            }
            $(this).siblings('.checkmark, .error-message').remove();
            if (errorMessage) {
                $('<div class="error-message"></div>').text(errorMessage).insertAfter($(this));
            } else {
                $('<div class="checkmark">✓</div>').insertAfter($(this));
            }
        });
    });
</script>
<script>
    function checkNickname() {
        // 닉네임 입력값 가져오기
        var nickname = document.getElementById("nicknameInput").value;

        // 닉네임 유효성 검사 (공백, 특수문자 제외한 2~10글자)
        var regex = /^[ㄱ-ㅎ|가-힣|a-z|A-Z|0-9]{2,10}$/;
        if (!regex.test(nickname)) {
            document.getElementById("nicknameCheckResult").innerHTML = "닉네임은 공백, 특수문자를 제외한 2~10글자로 입력해주세요.";
            return;
        }

        // 서버로 닉네임 중복 확인 요청 보내기 (AJAX 등을 사용하여 구현)
        // 예시: 여기에서는 닉네임이 중복되었다고 가정하고 결과를 보여줍니다.
        var isNicknameDuplicate = true;

        // 닉네임 중복 여부에 따라 결과 출력
        if (isNicknameDuplicate) {
            document.getElementById("nicknameCheckResult").innerHTML = "이미 사용 중인 닉네임입니다.";
        } else {
            document.getElementById("nicknameCheckResult").innerHTML = "사용 가능한 닉네임입니다.";
        }
    }

    document.getElementById("checkDuplicateBtn").addEventListener("click", checkNickname);
</script>

</body>
</html>